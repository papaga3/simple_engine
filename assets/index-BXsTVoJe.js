var g=Object.defineProperty;var w=(t,e,s)=>e in t?g(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var r=(t,e,s)=>w(t,typeof e!="symbol"?e+"":e,s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();class p{constructor(e,s){r(this,"lastTimeFrame");r(this,"accumulatedTime");r(this,"timeStep");r(this,"update");r(this,"render");r(this,"rafId");r(this,"isRunning");r(this,"mainLoop",e=>{if(!this.isRunning)return;let s=e-this.lastTimeFrame;this.lastTimeFrame=e,this.accumulatedTime+=s,this.accumulatedTime>=this.timeStep&&(this.update(this.timeStep),this.accumulatedTime-=this.timeStep),this.render(),this.rafId=requestAnimationFrame(this.mainLoop)});r(this,"start",()=>{this.isRunning||(this.isRunning=!0),this.rafId=requestAnimationFrame(this.mainLoop)});r(this,"stop",()=>{this.rafId&&cancelAnimationFrame(this.rafId),this.isRunning=!1});this.lastTimeFrame=0,this.accumulatedTime=0,this.timeStep=1e3/60,this.update=e,this.render=s,this.rafId=null,this.isRunning=!1}}var d=(t=>(t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t[t.ERROR=-1]="ERROR",t))(d||{});class y{constructor(){r(this,"heldDirections");r(this,"onArrowPressed",e=>{this.heldDirections.indexOf(e)===-1&&this.heldDirections.push(e)});r(this,"onArrowReleased",e=>{const s=this.heldDirections.indexOf(e);s!==-1&&this.heldDirections.splice(s,1)});r(this,"direction",()=>this.heldDirections.length===0?-1:this.heldDirections[this.heldDirections.length-1]);this.heldDirections=new Array,document.addEventListener("keydown",e=>{(e.code==="ArrowUp"||e.code==="KeyW")&&this.onArrowPressed(0),(e.code==="ArrowDown"||e.code==="KeyS")&&this.onArrowPressed(1),(e.code==="ArrowLeft"||e.code==="KeyA")&&this.onArrowPressed(2),(e.code==="ArrowRight"||e.code==="KeyD")&&this.onArrowPressed(3)}),document.addEventListener("keyup",e=>{(e.code==="ArrowUp"||e.code==="KeyW")&&this.onArrowReleased(0),(e.code==="ArrowDown"||e.code==="KeyS")&&this.onArrowReleased(1),(e.code==="ArrowLeft"||e.code==="KeyA")&&this.onArrowReleased(2),(e.code==="ArrowRight"||e.code==="KeyD")&&this.onArrowReleased(3)})}}class L{constructor(){r(this,"resourceList");r(this,"imageList");this.resourceList={sky:"/sprites/sky.png",ground:"/sprites/ground.png",hero:"/sprites/hero-sheet.png",shadow:"/sprites/shadow.png"},this.imageList={},Object.keys(this.resourceList).forEach(e=>{const s=new Image;s.src=this.resourceList[e],this.imageList[e]={image:s,isLoaded:!1},s.onload=()=>{this.imageList[e].isLoaded=!0}})}}const u=new L;class c{constructor(e,s){r(this,"x");r(this,"y");this.x=e,this.y=s}}class l{constructor(e){r(this,"resource");r(this,"frameSize");r(this,"hFrames");r(this,"vFrames");r(this,"frame");r(this,"scale");r(this,"frameMap");this.resource=e.resource,this.frameSize=e.frameSize??new c(16,16),this.hFrames=e.hFrames??1,this.vFrames=e.vFrames??1,this.frame=e.frame??0,this.scale=e.scale??1,this.frameMap=new Map,this.buildFrameMap()}buildFrameMap(){let e=0;for(let s=0;s<this.vFrames;s++)for(let a=0;a<this.hFrames;a++)this.frameMap.set(e,new c(this.frameSize.x*a,this.frameSize.y*s)),e++}drawImage(e,s,a){if(!this.resource.isLoaded)return;let i=0,o=0;const n=this.frameMap.get(this.frame);n&&(i=n.x,o=n.y);const m=this.frameSize.x,h=this.frameSize.y;e.drawImage(this.resource.image,i,o,m,h,s,a,m*this.scale,h*this.scale)}}const S=()=>{if(document.querySelector("#game_canvas")===null){console.error("Cannot find game canvas");return}const e=document.querySelector("#game_canvas").getContext("2d");if(e===null){console.error("Cannot create canvas context");return}const s=new l({resource:u.imageList.sky,frameSize:new c(320,180)}),a=new l({resource:u.imageList.ground,frameSize:new c(320,180)}),i=new l({resource:u.imageList.hero,frameSize:new c(32,32),hFrames:3,vFrames:8,frame:2}),o=new c(16*5,16*5),n=new l({resource:u.imageList.shadow,frameSize:new c(32,32)}),m=new y,h=()=>{switch(m.direction()){case d.UP:{console.log("UP"),o.y-=1,i.frame=6;break}case d.DOWN:{console.log("DOWN"),o.y+=1,i.frame=0;break}case d.LEFT:{console.log("LEFT"),o.x-=1,i.frame=9;break}case d.RIGHT:{console.log("RIGHT"),o.x+=1,i.frame=3;break}}},f=()=>{s.drawImage(e,0,0),a.drawImage(e,0,0),n.drawImage(e,o.x,o.y),i.drawImage(e,o.x,o.y)};new p(h,f).start()};S();
