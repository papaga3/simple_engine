var x=Object.defineProperty;var O=(i,e,t)=>e in i?x(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var s=(i,e,t)=>O(i,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();class P{constructor(e,t){s(this,"lastTimeFrame");s(this,"accumulatedTime");s(this,"timeStep");s(this,"update");s(this,"render");s(this,"rafId");s(this,"isRunning");s(this,"mainLoop",e=>{if(!this.isRunning)return;let t=e-this.lastTimeFrame;this.lastTimeFrame=e,this.accumulatedTime+=t,this.accumulatedTime>=this.timeStep&&(this.update(this.timeStep),this.accumulatedTime=0),this.render(),this.rafId=requestAnimationFrame(this.mainLoop)});s(this,"start",()=>{this.isRunning||(this.isRunning=!0),this.rafId=requestAnimationFrame(this.mainLoop)});s(this,"stop",()=>{this.rafId&&cancelAnimationFrame(this.rafId),this.isRunning=!1});this.lastTimeFrame=0,this.accumulatedTime=0,this.timeStep=1e3/60,this.update=e,this.render=t,this.rafId=null,this.isRunning=!1}}const b=i=>i*16,I=(i,e,t)=>{const n=`${e},${t}`;return!i.has(n)},m=new Set;m.add("64,48");m.add("64,64");m.add("64,80");m.add("80,64");m.add("80,80");m.add("112,80");m.add("128,80");m.add("144,80");m.add("160,80");class k{constructor(e){s(this,"patterns");s(this,"activeKey");s(this,"step",e=>{this.patterns[this.activeKey].step(e)});s(this,"play",(e,t=0)=>{this.activeKey!==e&&(this.activeKey=e,this.patterns[this.activeKey].currentTime=t)});s(this,"frame",()=>this.patterns[this.activeKey].frame());this.patterns=e,this.activeKey=Object.keys(this.patterns)[0]}}class l{constructor(e){s(this,"animationConfig");s(this,"currentTime");s(this,"duration");s(this,"step",e=>{this.currentTime+=e,this.currentTime>=this.duration&&(this.currentTime=0)});s(this,"frame",()=>{const{frames:e}=this.animationConfig;for(let t=e.length-1;t>=0;t--)if(this.currentTime>=e[t].time)return e[t].frame;throw"Time is before the first keyframe"});this.currentTime=0,this.animationConfig=e,this.duration=e.duration??500}}class c{constructor(e,t){s(this,"x");s(this,"y");s(this,"duplicate",()=>new c(this.x,this.y));this.x=e,this.y=t}}class L{constructor(e){s(this,"position");s(this,"children");s(this,"drawOffSet");s(this,"stepEntry",(e,t)=>{this.children.forEach(n=>n.stepEntry(e,t)),this.step(e,t)});s(this,"draw",(e,t,n)=>{const r=t+this.position.x+this.drawOffSet.x,a=n+this.position.y+this.drawOffSet.y;this.drawImage(e,r,a),this.children.forEach(o=>o.draw(e,r,a))});this.drawOffSet=e.drawOffSet??new c(0,0),this.position=e.position??new c(0,0),this.children=[]}addChild(e){this.children.push(e)}removeChild(e){this.children=this.children.filter(t=>e!==t)}}const K=(i,e,t)=>{let n=e.x-i.position.x,r=e.y-i.position.y,a=Math.sqrt(n**2+r**2);if(a<=t)i.position.x=e.x,i.position.y=e.y;else{const o=n/a,d=r/a;i.position.x+=o*t,i.position.y+=d*t,n=e.x-i.position.x,r=e.y-i.position.y,a=Math.sqrt(n**2+r**2)}return a};var h=(i=>(i[i.UP=0]="UP",i[i.DOWN=1]="DOWN",i[i.LEFT=2]="LEFT",i[i.RIGHT=3]="RIGHT",i[i.ERROR=-1]="ERROR",i))(h||{});class D{constructor(){s(this,"heldDirections");s(this,"onArrowPressed",e=>{this.heldDirections.indexOf(e)===-1&&this.heldDirections.push(e)});s(this,"onArrowReleased",e=>{const t=this.heldDirections.indexOf(e);t!==-1&&this.heldDirections.splice(t,1)});s(this,"direction",()=>this.heldDirections.length===0?-1:this.heldDirections[this.heldDirections.length-1]);this.heldDirections=new Array,document.addEventListener("keydown",e=>{(e.code==="ArrowUp"||e.code==="KeyW")&&this.onArrowPressed(0),(e.code==="ArrowDown"||e.code==="KeyS")&&this.onArrowPressed(1),(e.code==="ArrowLeft"||e.code==="KeyA")&&this.onArrowPressed(2),(e.code==="ArrowRight"||e.code==="KeyD")&&this.onArrowPressed(3)}),document.addEventListener("keyup",e=>{(e.code==="ArrowUp"||e.code==="KeyW")&&this.onArrowReleased(0),(e.code==="ArrowDown"||e.code==="KeyS")&&this.onArrowReleased(1),(e.code==="ArrowLeft"||e.code==="KeyA")&&this.onArrowReleased(2),(e.code==="ArrowRight"||e.code==="KeyD")&&this.onArrowReleased(3)})}}class E{constructor(){s(this,"resourceList");s(this,"imageList");this.resourceList={sky:"sprites/sky.png",ground:"sprites/ground.png",hero:"sprites/hero-sheet.png",shadow:"sprites/shadow.png"},this.imageList={},Object.keys(this.resourceList).forEach(e=>{const t=new Image;t.src=this.resourceList[e],this.imageList[e]={image:t,isLoaded:!1},t.onload=()=>{this.imageList[e].isLoaded=!0}})}}const w=new E;class p extends L{constructor(t){super({position:t.position});s(this,"resource");s(this,"frameSize");s(this,"hFrames");s(this,"vFrames");s(this,"frame");s(this,"scale");s(this,"frameMap");s(this,"animations");this.resource=t.resource,this.frameSize=t.frameSize??new c(16,16),this.hFrames=t.hFrames??1,this.vFrames=t.vFrames??1,this.frame=t.frame??0,this.scale=t.scale??1,this.frameMap=new Map,this.buildFrameMap(),this.animations=t.animations??null}buildFrameMap(){let t=0;for(let n=0;n<this.vFrames;n++)for(let r=0;r<this.hFrames;r++)this.frameMap.set(t,new c(this.frameSize.x*r,this.frameSize.y*n)),t++}step(t){this.animations&&(this.animations.step(t),this.frame=this.animations.frame())}drawImage(t,n,r){if(!this.resource.isLoaded)return;let a=0,o=0;const d=this.frameMap.get(this.frame);d&&(a=d.x,o=d.y);const u=this.frameSize.x,f=this.frameSize.y;t.drawImage(this.resource.image,a,o,u,f,n,r,u*this.scale,f*this.scale)}}const y=(i=0)=>({duration:400,frames:[{time:0,frame:i+1},{time:100,frame:i},{time:200,frame:i+1},{time:300,frame:i+2}]}),g=(i=0)=>({duration:400,frames:[{time:0,frame:i}]}),C=y(0),z=y(3),N=y(6),W=y(9),M=g(1),U=g(4),_=g(7),G=g(10);class q extends L{constructor(t,n){super({position:new c(t,n)});s(this,"heroFacing");s(this,"destinationPositon");s(this,"body");s(this,"step",(t,n)=>{K(this,this.destinationPositon,1)<=1&&this.tryMove(n)});s(this,"drawImage",()=>{});s(this,"tryMove",t=>{var u,f,S,R,A,T,F,v;const{input:n,walls:r}=t;if(n.direction()===null||n.direction()===h.ERROR){switch(this.heroFacing){case h.DOWN:{(u=this.body.animations)==null||u.play("standDown");break}case h.UP:{(f=this.body.animations)==null||f.play("standUp");break}case h.LEFT:{(S=this.body.animations)==null||S.play("standLeft");break}case h.RIGHT:{(R=this.body.animations)==null||R.play("standRight");break}}return}let a=this.destinationPositon.x,o=this.destinationPositon.y;const d=16;switch(n.direction()){case h.UP:{o-=d,(A=this.body.animations)==null||A.play("walkUp");break}case h.DOWN:{o+=d,(T=this.body.animations)==null||T.play("walkDown");break}case h.LEFT:{a-=d,(F=this.body.animations)==null||F.play("walkLeft");break}case h.RIGHT:{a+=d,(v=this.body.animations)==null||v.play("walkRight");break}}n.direction()!==h.ERROR&&(this.heroFacing=n.direction()),I(r,a,o)&&(this.destinationPositon.x=a,this.destinationPositon.y=o)});this.heroFacing=h.DOWN,this.destinationPositon=this.position.duplicate(),this.body=new p({resource:w.imageList.hero,frameSize:new c(32,32),hFrames:3,vFrames:8,frame:2,position:new c(-8,-20),animations:new k({walkDown:new l(C),walkUp:new l(N),walkLeft:new l(W),walkRight:new l(z),standDown:new l(M),standUp:new l(_),standLeft:new l(G),standRight:new l(U)})}),this.addChild(this.body);const r=new p({resource:w.imageList.shadow,frameSize:new c(32,32),position:new c(-8,-20)});this.addChild(r)}}class H extends L{constructor(t){super({position:new c(0,0)});s(this,"input");s(this,"walls");this.input=new D,this.walls=t.walls??new Set}step(){}drawImage(){}}const X=()=>{if(document.querySelector("#game_canvas")===null){console.error("Cannot find game canvas");return}const i=document.querySelector("#game_canvas"),e=i.getContext("2d");if(e===null){console.error("Cannot create canvas context");return}const t=new H({walls:m}),n=new p({resource:w.imageList.sky,frameSize:new c(320,180),position:new c(0,0)});t.addChild(n);const r=new p({resource:w.imageList.ground,frameSize:new c(320,180),position:new c(0,0)});t.addChild(r);const a=new q(b(6),b(5));t.addChild(a);const o=f=>{t.stepEntry(f,t)},d=()=>{e.clearRect(0,0,i.width,i.height),t.draw(e,0,0)};new P(o,d).start()};X();
